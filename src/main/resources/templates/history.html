<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>トレーニング履歴</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* グラフエリアは初期状態では非表示にする場合（今回はJSで制御） */
        .view-section { display: none; }
        .view-section.active { display: block; }
    </style>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">
</head>
<body class="bg-light">

<nav class="navbar navbar-dark bg-dark mb-4">
    <div class="container-fluid">
        <a class="navbar-brand" href="/">筋トレ管理アプリ</a>
        <a class="btn btn-outline-light btn-sm" href="/">ホームに戻る</a>
    </div>
</nav>

<div class="container">
    <h2 class="mb-4">トレーニング履歴</h2>

    <div class="btn-group mb-4" role="group">
        <button type="button" class="btn btn-outline-primary active" id="btnList" onclick="switchView('list')">リスト表示</button>
        <button type="button" class="btn btn-outline-primary" id="btnGraph" onclick="switchView('graph')">グラフ表示</button>
    </div>

    <div class="card shadow-sm">
        <div class="card-body">

            <div id="listView" class="view-section active">
                <table class="table table-striped table-hover" th:if="${not #lists.isEmpty(details)}">
                    <thead class="table-dark">
                    <tr>
                        <th>日付</th>
                        <th>種目</th>
                        <th>重量</th>
                        <th>回数</th>
                        <th>セット数</th>
                        <th>メモ</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="detail : ${details}">
                        <td th:text="${detail.memo.training.trainingDay}">2023-01-01</td>
                        <td th:text="${detail.memo.exercise.exerciseName}">ベンチプレス</td>
                        <td th:text="${detail.weight} + ' kg'">60 kg</td>
                        <td th:text="${detail.rep} + '回'">10回</td>
                        <td th:text="${detail.setCount} + 'セット'">3セット</td>
                        <td th:text="${detail.memo.memoContent}">メモ内容</td>
                    </tr>
                    </tbody>
                </table>
                <div class="alert alert-info" th:if="${#lists.isEmpty(details)}">
                    まだ記録がありません。<a href="/training/record" class="alert-link">最初のトレーニング</a>を記録しましょう！
                </div>
            </div>

            <div id="graphView" class="view-section">
                <h5 class="card-title text-center mb-4">ボリューム推移（過去7日間）</h5>
                <canvas id="historyChart"></canvas>
            </div>

        </div>
    </div>
</div>

<script th:inline="javascript">
    // 1. 切り替え機能
    function switchView(viewName) {
        // エリアの切り替え
        document.getElementById('listView').classList.remove('active');
        document.getElementById('graphView').classList.remove('active');
        document.getElementById(viewName + 'View').classList.add('active');

        // ボタンの見た目切り替え
        document.getElementById('btnList').classList.remove('active');
        document.getElementById('btnGraph').classList.remove('active');

        if(viewName === 'list') {
            document.getElementById('btnList').classList.add('active');
        } else {
            document.getElementById('btnGraph').classList.add('active');
        }
    }

    // 2. グラフ描画
    const ctx = document.getElementById('historyChart').getContext('2d');
    const labels = /*[[${chartLabels}]]*/ [];
    const dataValues = /*[[${chartValues}]]*/ [];

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: '総負荷量 (kg)',
                data: dataValues,
                borderColor: 'rgb(54, 162, 235)', // 青色に変更
                backgroundColor: 'rgba(54, 162, 235, 0.2)',
                tension: 0.3,
                fill: true
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: { beginAtZero: true }
            }
        }
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="/js/main.js"></script>
</body>
</html>